<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loan Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .nav {
            background: #34495e;
            padding: 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-btn {
            background: none;
            border: none;
            color: white;
            padding: 15px 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            font-weight: 500;
        }

        .nav-btn:hover, .nav-btn.active {
            background: #3498db;
            transform: translateY(-2px);
        }

        .content {
            padding: 30px;
            min-height: 600px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #d68910);
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 4px solid #3498db;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(116, 185, 255, 0.3);
        }

        .stat-card.success {
            background: linear-gradient(135deg, #00b894, #00a085);
        }

        .stat-card.warning {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
        }

        .stat-card.danger {
            background: linear-gradient(135deg, #fd79a8, #e84393);
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .table th {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .table td {
            padding: 15px;
            border-bottom: 1px solid #ecf0f1;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        .status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .status.active {
            background: #d4edda;
            color: #155724;
        }

        .status.overdue {
            background: #f8d7da;
            color: #721c24;
        }

        .status.closed {
            background: #d1ecf1;
            color: #0c5460;
        }

        .form-row {
            display: flex;
            gap: 20px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .filters {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: end;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        @media (max-width: 768px) {
            .nav {
                flex-direction: column;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .table {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ’° Loan Management System</h1>
            <p>Complete financial management for your lending business</p>
        </div>

        <nav class="nav">
            <button class="nav-btn active" onclick="showSection('dashboard')">ðŸ“Š Dashboard</button>
            <button class="nav-btn" onclick="showSection('loans')">ðŸ’¼ Loans</button>
            <button class="nav-btn" onclick="showSection('income')">ðŸ’° Income</button>
            <button class="nav-btn" onclick="showSection('expenses')">ðŸ’¸ Expenses</button>
            <button class="nav-btn" onclick="showSection('transactions')">ðŸ“‹ Transactions</button>
            <button class="nav-btn" onclick="showSection('reports')">ðŸ“ˆ Reports</button>
            <button class="nav-btn" onclick="showSection('clients')">ðŸ‘¥ Clients</button>
        </nav>

        <div class="content">
            <!-- Dashboard Section -->
            <section id="dashboard" class="section active">
                <h2>Dashboard Overview</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalLoans">0</div>
                        <div class="stat-label">Total Loans</div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-value" id="activeLoans">0</div>
                        <div class="stat-label">Active Loans</div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-value" id="overdueLoans">0</div>
                        <div class="stat-label">Overdue Loans</div>
                    </div>
                    <div class="stat-card danger">
                        <div class="stat-value" id="totalAmount">$0</div>
                        <div class="stat-label">Total Amount</div>
                    </div>
                </div>

                <div class="chart-container">
                    <h3>Monthly Overview</h3>
                    <canvas id="monthlyChart" width="400" height="200"></canvas>
                </div>

                <div class="card">
                    <h3>Recent Activity</h3>
                    <div id="recentActivity">
                        <p>No recent activity</p>
                    </div>
                </div>
            </section>

            <!-- Loans Section -->
            <section id="loans" class="section">
                <h2>Loan Management</h2>
                
                <div class="card">
                    <button class="btn" onclick="openModal('loanModal')">+ Add New Loan</button>
                    <button class="btn btn-warning" onclick="exportPDF('loans')">ðŸ“„ Export PDF</button>
                </div>

                <div class="filters">
                    <div class="form-group">
                        <label>Status Filter</label>
                        <select id="loanStatusFilter" onchange="filterLoans()">
                            <option value="">All Statuses</option>
                            <option value="pending">Pending</option>
                            <option value="active">Active</option>
                            <option value="overdue">Overdue</option>
                            <option value="closed">Closed</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Search</label>
                        <input type="text" id="loanSearch" placeholder="Search by client name..." onkeyup="filterLoans()">
                    </div>
                </div>

                <table class="table">
                    <thead>
                        <tr>
                            <th>Client</th>
                            <th>Amount</th>
                            <th>Interest Rate</th>
                            <th>Start Date</th>
                            <th>Due Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="loansTable">
                    </tbody>
                </table>
            </section>

            <!-- Income Section -->
            <section id="income" class="section">
                <h2>Income Management</h2>
                
                <div class="card">
                    <button class="btn" onclick="openModal('incomeModal')">+ Add Income</button>
                    <button class="btn btn-warning" onclick="exportPDF('income')">ðŸ“„ Export PDF</button>
                </div>

                <div class="filters">
                    <div class="form-group">
                        <label>Date From</label>
                        <input type="date" id="incomeDateFrom" onchange="filterIncome()">
                    </div>
                    <div class="form-group">
                        <label>Date To</label>
                        <input type="date" id="incomeDateTo" onchange="filterIncome()">
                    </div>
                    <div class="form-group">
                        <label>Source</label>
                        <select id="incomeSourceFilter" onchange="filterIncome()">
                            <option value="">All Sources</option>
                            <option value="repayment">Loan Repayment</option>
                            <option value="interest">Interest</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>

                <table class="table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Source</th>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="incomeTable">
                    </tbody>
                </table>
            </section>

            <!-- Expenses Section -->
            <section id="expenses" class="section">
                <h2>Expense Management</h2>
                
                <div class="card">
                    <button class="btn" onclick="openModal('expenseModal')">+ Add Expense</button>
                    <button class="btn btn-warning" onclick="exportPDF('expenses')">ðŸ“„ Export PDF</button>
                </div>

                <div class="filters">
                    <div class="form-group">
                        <label>Date From</label>
                        <input type="date" id="expenseDateFrom" onchange="filterExpenses()">
                    </div>
                    <div class="form-group">
                        <label>Date To</label>
                        <input type="date" id="expenseDateTo" onchange="filterExpenses()">
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <select id="expenseCategoryFilter" onchange="filterExpenses()">
                            <option value="">All Categories</option>
                            <option value="operational">Operational</option>
                            <option value="staff">Staff</option>
                            <option value="utilities">Utilities</option>
                            <option value="marketing">Marketing</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>

                <table class="table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Category</th>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="expensesTable">
                    </tbody>
                </table>
            </section>

            <!-- Transactions Section -->
            <section id="transactions" class="section">
                <h2>All Transactions</h2>
                
                <div class="card">
                    <button class="btn btn-warning" onclick="exportPDF('transactions')">ðŸ“„ Export PDF</button>
                </div>

                <div class="filters">
                    <div class="form-group">
                        <label>Date From</label>
                        <input type="date" id="transactionDateFrom" onchange="filterTransactions()">
                    </div>
                    <div class="form-group">
                        <label>Date To</label>
                        <input type="date" id="transactionDateTo" onchange="filterTransactions()">
                    </div>
                    <div class="form-group">
                        <label>Type</label>
                        <select id="transactionTypeFilter" onchange="filterTransactions()">
                            <option value="">All Types</option>
                            <option value="income">Income</option>
                            <option value="expense">Expense</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Search</label>
                        <input type="text" id="transactionSearch" placeholder="Search transactions..." onkeyup="filterTransactions()">
                    </div>
                </div>

                <table class="table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Category/Source</th>
                            <th>Description</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody id="transactionsTable">
                    </tbody>
                </table>
            </section>

            <!-- Reports Section -->
            <section id="reports" class="section">
                <h2>Reports & Analytics</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="reportTotalIncome">$0</div>
                        <div class="stat-label">Total Income</div>
                    </div>
                    <div class="stat-card danger">
                        <div class="stat-value" id="reportTotalExpenses">$0</div>
                        <div class="stat-label">Total Expenses</div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-value" id="reportNetProfit">$0</div>
                        <div class="stat-label">Net Profit</div>
                    </div>
                </div>

                <div class="card">
                    <h3>Generate Reports</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Report Type</label>
                            <select id="reportType">
                                <option value="monthly">Monthly Summary</option>
                                <option value="yearly">Yearly Summary</option>
                                <option value="loans">Loan Summary</option>
                                <option value="profit">Profit/Loss Analysis</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Period</label>
                            <input type="month" id="reportPeriod">
                        </div>
                    </div>
                    <button class="btn" onclick="generateReport()">Generate Report</button>
                    <button class="btn btn-warning" onclick="exportPDF('report')">ðŸ“„ Export PDF</button>
                </div>

                <div class="chart-container">
                    <h3>Profit/Loss Chart</h3>
                    <canvas id="profitChart" width="400" height="200"></canvas>
                </div>
            </section>

            <!-- Clients Section -->
            <section id="clients" class="section">
                <h2>Client Management</h2>
                
                <div class="card">
                    <button class="btn" onclick="openModal('clientModal')">+ Add New Client</button>
                    <button class="btn btn-warning" onclick="exportPDF('clients')">ðŸ“„ Export PDF</button>
                </div>

                <div class="filters">
                    <div class="form-group">
                        <label>Search</label>
                        <input type="text" id="clientSearch" placeholder="Search clients..." onkeyup="filterClients()">
                    </div>
                </div>

                <table class="table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Phone</th>
                            <th>Email</th>
                            <th>Total Loans</th>
                            <th>Active Loans</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="clientsTable">
                    </tbody>
                </table>
            </section>
        </div>
    </div>

    <!-- Modals -->
    <!-- Loan Modal -->
    <div id="loanModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('loanModal')">&times;</span>
            <h2>Add New Loan</h2>
            <form id="loanForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>Client</label>
                        <select id="loanClient" required>
                            <option value="">Select Client</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Amount (R)</label>
                        <input type="number" id="loanAmount" step="0.01" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Interest Rate (%)</label>
                        <input type="number" id="loanInterest" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Term (months)</label>
                        <input type="number" id="loanTerm" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Start Date</label>
                        <input type="date" id="loanStartDate" required>
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="loanStatus" required>
                            <option value="pending">Pending</option>
                            <option value="active">Active</option>
                            <option value="overdue">Overdue</option>
                            <option value="closed">Closed</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="loanNotes" rows="3"></textarea>
                </div>
                <button type="submit" class="btn">Add Loan</button>
            </form>
        </div>
    </div>

    <!-- Income Modal -->
    <div id="incomeModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('incomeModal')">&times;</span>
            <h2>Add Income</h2>
            <form id="incomeForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="incomeDate" required>
                    </div>
                    <div class="form-group">
                        <label>Source</label>
                        <select id="incomeSource" required>
                            <option value="repayment">Loan Repayment</option>
                            <option value="interest">Interest</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <input type="text" id="incomeDescription" required>
                </div>
                <div class="form-group">
                                            <label>Amount (R)</label>
                    <input type="number" id="incomeAmount" step="0.01" required>
                </div>
                <button type="submit" class="btn">Add Income</button>
            </form>
        </div>
    </div>

    <!-- Expense Modal -->
    <div id="expenseModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('expenseModal')">&times;</span>
            <h2>Add Expense</h2>
            <form id="expenseForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="expenseDate" required>
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <select id="expenseCategory" required>
                            <option value="operational">Operational</option>
                            <option value="staff">Staff</option>
                            <option value="utilities">Utilities</option>
                            <option value="marketing">Marketing</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <input type="text" id="expenseDescription" required>
                </div>
                <div class="form-group">
                                            <label>Amount (R)</label>
                    <input type="number" id="expenseAmount" step="0.01" required>
                </div>
                <button type="submit" class="btn">Add Expense</button>
            </form>
        </div>
    </div>

    <!-- Client Modal -->
    <div id="clientModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('clientModal')">&times;</span>
            <h2>Add New Client</h2>
            <form id="clientForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>First Name</label>
                        <input type="text" id="clientFirstName" required>
                    </div>
                    <div class="form-group">
                        <label>Last Name</label>
                        <input type="text" id="clientLastName" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" id="clientPhone" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="clientEmail">
                    </div>
                </div>
                <div class="form-group">
                    <label>Address</label>
                    <textarea id="clientAddress" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="clientNotes" rows="3"></textarea>
                </div>
                <button type="submit" class="btn">Add Client</button>
            </form>
        </div>
    </div>

    <script>
        // Data Storage
        let loans = JSON.parse(localStorage.getItem('loans')) || [];
        let income = JSON.parse(localStorage.getItem('income')) || [];
        let expenses = JSON.parse(localStorage.getItem('expenses')) || [];
        let clients = JSON.parse(localStorage.getItem('clients')) || [];

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            updateDashboard();
            populateClients();
            renderLoans();
            renderIncome();
            renderExpenses();
            renderTransactions();
            renderClients();
            setupCharts();
        }

        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');
            
            if (sectionId === 'reports') {
                updateReports();
            }
        }

        // Modal Management
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Client Management
        function populateClients() {
            const clientSelect = document.getElementById('loanClient');
            clientSelect.innerHTML = '<option value="">Select Client</option>';
            clients.forEach(client => {
                const option = document.createElement('option');
                option.value = client.id;
                option.textContent = `${client.firstName} ${client.lastName}`;
                clientSelect.appendChild(option);
            });
        }

        document.getElementById('clientForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const client = {
                id: Date.now().toString(),
                firstName: document.getElementById('clientFirstName').value,
                lastName: document.getElementById('clientLastName').value,
                phone: document.getElementById('clientPhone').value,
                email: document.getElementById('clientEmail').value,
                address: document.getElementById('clientAddress').value,
                notes: document.getElementById('clientNotes').value,
                createdAt: new Date().toISOString()
            };
            
            clients.push(client);
            localStorage.setItem('clients', JSON.stringify(clients));
            
            closeModal('clientModal');
            this.reset();
            populateClients();
            renderClients();
            updateDashboard();
        });

        function renderClients() {
            const tbody = document.getElementById('clientsTable');
            tbody.innerHTML = '';
            
            clients.forEach(client => {
                const clientLoans = loans.filter(loan => loan.clientId === client.id);
                const activeLoans = clientLoans.filter(loan => loan.status === 'active');
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${client.firstName} ${client.lastName}</td>
                    <td>${client.phone}</td>
                    <td>${client.email || 'N/A'}</td>
                    <td>${clientLoans.length}</td>
                    <td>${activeLoans.length}</td>
                    <td>
                        <button class="btn btn-warning" onclick="editClient('${client.id}')">Edit</button>
                        <button class="btn btn-danger" onclick="deleteClient('${client.id}')">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function filterClients() {
            const search = document.getElementById('clientSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#clientsTable tr');
            
            rows.forEach(row => {
                const name = row.cells[0].textContent.toLowerCase();
                const phone = row.cells[1].textContent.toLowerCase();
                const email = row.cells[2].textContent.toLowerCase();
                
                if (name.includes(search) || phone.includes(search) || email.includes(search)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function deleteClient(clientId) {
            if (confirm('Are you sure you want to delete this client?')) {
                clients = clients.filter(client => client.id !== clientId);
                localStorage.setItem('clients', JSON.stringify(clients));
                renderClients();
                populateClients();
                updateDashboard();
            }
        }

        // Loan Management
        document.getElementById('loanForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const loan = {
                id: Date.now().toString(),
                clientId: document.getElementById('loanClient').value,
                amount: parseFloat(document.getElementById('loanAmount').value),
                interestRate: parseFloat(document.getElementById('loanInterest').value),
                term: parseInt(document.getElementById('loanTerm').value),
                startDate: document.getElementById('loanStartDate').value,
                status: document.getElementById('loanStatus').value,
                notes: document.getElementById('loanNotes').value,
                createdAt: new Date().toISOString()
            };
            
            // Calculate due date
            const startDate = new Date(loan.startDate);
            const dueDate = new Date(startDate);
            dueDate.setMonth(dueDate.getMonth() + loan.term);
            loan.dueDate = dueDate.toISOString().split('T')[0];
            
            loans.push(loan);
            localStorage.setItem('loans', JSON.stringify(loans));
            
            closeModal('loanModal');
            this.reset();
            renderLoans();
            updateDashboard();
        });

        function renderLoans() {
            const tbody = document.getElementById('loansTable');
            tbody.innerHTML = '';
            
            loans.forEach(loan => {
                const client = clients.find(c => c.id === loan.clientId);
                const clientName = client ? `${client.firstName} ${client.lastName}` : 'Unknown Client';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${clientName}</td>
                    <td>${loan.amount.toFixed(2)}</td>
                    <td>${loan.interestRate}%</td>
                    <td>${new Date(loan.startDate).toLocaleDateString()}</td>
                    <td>${new Date(loan.dueDate).toLocaleDateString()}</td>
                    <td><span class="status ${loan.status}">${loan.status}</span></td>
                    <td>
                        <button class="btn btn-success" onclick="recordRepayment('${loan.id}')">Repayment</button>
                        <button class="btn btn-warning" onclick="editLoan('${loan.id}')">Edit</button>
                        <button class="btn btn-danger" onclick="deleteLoan('${loan.id}')">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function filterLoans() {
            const statusFilter = document.getElementById('loanStatusFilter').value;
            const searchFilter = document.getElementById('loanSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#loansTable tr');
            
            rows.forEach(row => {
                const status = row.querySelector('.status').textContent;
                const clientName = row.cells[0].textContent.toLowerCase();
                
                const statusMatch = !statusFilter || status === statusFilter;
                const searchMatch = !searchFilter || clientName.includes(searchFilter);
                
                if (statusMatch && searchMatch) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function recordRepayment(loanId) {
            const amount = prompt('Enter repayment amount:');
            if (amount && !isNaN(amount)) {
                const repayment = {
                    id: Date.now().toString(),
                    date: new Date().toISOString().split('T')[0],
                    source: 'repayment',
                    description: `Loan repayment - ID: ${loanId}`,
                    amount: parseFloat(amount),
                    loanId: loanId
                };
                
                income.push(repayment);
                localStorage.setItem('income', JSON.stringify(income));
                
                renderIncome();
                renderTransactions();
                updateDashboard();
                alert('Repayment recorded successfully!');
            }
        }

        function deleteLoan(loanId) {
            if (confirm('Are you sure you want to delete this loan?')) {
                loans = loans.filter(loan => loan.id !== loanId);
                localStorage.setItem('loans', JSON.stringify(loans));
                renderLoans();
                updateDashboard();
            }
        }

        // Income Management
        document.getElementById('incomeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const incomeItem = {
                id: Date.now().toString(),
                date: document.getElementById('incomeDate').value,
                source: document.getElementById('incomeSource').value,
                description: document.getElementById('incomeDescription').value,
                amount: parseFloat(document.getElementById('incomeAmount').value),
                createdAt: new Date().toISOString()
            };
            
            income.push(incomeItem);
            localStorage.setItem('income', JSON.stringify(income));
            
            closeModal('incomeModal');
            this.reset();
            renderIncome();
            renderTransactions();
            updateDashboard();
        });

        function renderIncome() {
            const tbody = document.getElementById('incomeTable');
            tbody.innerHTML = '';
            
            income.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(item.date).toLocaleDateString()}</td>
                    <td>${item.source}</td>
                    <td>${item.description}</td>
                    <td>${item.amount.toFixed(2)}</td>
                    <td>
                        <button class="btn btn-warning" onclick="editIncome('${item.id}')">Edit</button>
                        <button class="btn btn-danger" onclick="deleteIncome('${item.id}')">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function filterIncome() {
            const dateFrom = document.getElementById('incomeDateFrom').value;
            const dateTo = document.getElementById('incomeDateTo').value;
            const sourceFilter = document.getElementById('incomeSourceFilter').value;
            const rows = document.querySelectorAll('#incomeTable tr');
            
            rows.forEach(row => {
                const date = new Date(row.cells[0].textContent).toISOString().split('T')[0];
                const source = row.cells[1].textContent;
                
                const dateMatch = (!dateFrom || date >= dateFrom) && (!dateTo || date <= dateTo);
                const sourceMatch = !sourceFilter || source === sourceFilter;
                
                if (dateMatch && sourceMatch) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function deleteIncome(incomeId) {
            if (confirm('Are you sure you want to delete this income record?')) {
                income = income.filter(item => item.id !== incomeId);
                localStorage.setItem('income', JSON.stringify(income));
                renderIncome();
                renderTransactions();
                updateDashboard();
            }
        }

        // Expense Management
        document.getElementById('expenseForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const expenseItem = {
                id: Date.now().toString(),
                date: document.getElementById('expenseDate').value,
                category: document.getElementById('expenseCategory').value,
                description: document.getElementById('expenseDescription').value,
                amount: parseFloat(document.getElementById('expenseAmount').value),
                createdAt: new Date().toISOString()
            };
            
            expenses.push(expenseItem);
            localStorage.setItem('expenses', JSON.stringify(expenses));
            
            closeModal('expenseModal');
            this.reset();
            renderExpenses();
            renderTransactions();
            updateDashboard();
        });

        function renderExpenses() {
            const tbody = document.getElementById('expensesTable');
            tbody.innerHTML = '';
            
            expenses.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(item.date).toLocaleDateString()}</td>
                    <td>${item.category}</td>
                    <td>${item.description}</td>
                    <td>${item.amount.toFixed(2)}</td>
                    <td>
                        <button class="btn btn-warning" onclick="editExpense('${item.id}')">Edit</button>
                        <button class="btn btn-danger" onclick="deleteExpense('${item.id}')">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function filterExpenses() {
            const dateFrom = document.getElementById('expenseDateFrom').value;
            const dateTo = document.getElementById('expenseDateTo').value;
            const categoryFilter = document.getElementById('expenseCategoryFilter').value;
            const rows = document.querySelectorAll('#expensesTable tr');
            
            rows.forEach(row => {
                const date = new Date(row.cells[0].textContent).toISOString().split('T')[0];
                const category = row.cells[1].textContent;
                
                const dateMatch = (!dateFrom || date >= dateFrom) && (!dateTo || date <= dateTo);
                const categoryMatch = !categoryFilter || category === categoryFilter;
                
                if (dateMatch && categoryMatch) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function deleteExpense(expenseId) {
            if (confirm('Are you sure you want to delete this expense record?')) {
                expenses = expenses.filter(item => item.id !== expenseId);
                localStorage.setItem('expenses', JSON.stringify(expenses));
                renderExpenses();
                renderTransactions();
                updateDashboard();
            }
        }

        // Transaction Management
        function renderTransactions() {
            const tbody = document.getElementById('transactionsTable');
            tbody.innerHTML = '';
            
            const allTransactions = [
                ...income.map(item => ({...item, type: 'income', categorySource: item.source})),
                ...expenses.map(item => ({...item, type: 'expense', categorySource: item.category}))
            ].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            allTransactions.forEach(transaction => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(transaction.date).toLocaleDateString()}</td>
                    <td><span class="status ${transaction.type}">${transaction.type}</span></td>
                    <td>${transaction.categorySource}</td>
                    <td>${transaction.description}</td>
                    <td style="color: ${transaction.type === 'income' ? 'green' : 'red'}">
                        ${transaction.type === 'income' ? '+' : '-'}${transaction.amount.toFixed(2)}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function filterTransactions() {
            const dateFrom = document.getElementById('transactionDateFrom').value;
            const dateTo = document.getElementById('transactionDateTo').value;
            const typeFilter = document.getElementById('transactionTypeFilter').value;
            const searchFilter = document.getElementById('transactionSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#transactionsTable tr');
            
            rows.forEach(row => {
                const date = new Date(row.cells[0].textContent).toISOString().split('T')[0];
                const type = row.cells[1].textContent.trim();
                const description = row.cells[3].textContent.toLowerCase();
                
                const dateMatch = (!dateFrom || date >= dateFrom) && (!dateTo || date <= dateTo);
                const typeMatch = !typeFilter || type === typeFilter;
                const searchMatch = !searchFilter || description.includes(searchFilter);
                
                if (dateMatch && typeMatch && searchMatch) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // Dashboard Updates
        function updateDashboard() {
            const totalLoans = loans.length;
            const activeLoans = loans.filter(loan => loan.status === 'active').length;
            const overdueLoans = loans.filter(loan => loan.status === 'overdue').length;
            const totalAmount = loans.reduce((sum, loan) => sum + loan.amount, 0);
            
            document.getElementById('totalLoans').textContent = totalLoans;
            document.getElementById('activeLoans').textContent = activeLoans;
            document.getElementById('overdueLoans').textContent = overdueLoans;
            document.getElementById('totalAmount').textContent = `${totalAmount.toFixed(2)}`;
            
            updateRecentActivity();
        }

        function updateRecentActivity() {
            const recentActivity = document.getElementById('recentActivity');
            const allActivities = [
                ...loans.slice(-5).map(loan => ({
                    text: `New loan of ${loan.amount} created`,
                    date: loan.createdAt
                })),
                ...income.slice(-5).map(item => ({
                    text: `Income of ${item.amount} recorded`,
                    date: item.createdAt
                })),
                ...expenses.slice(-5).map(item => ({
                    text: `Expense of ${item.amount} recorded`,
                    date: item.createdAt
                }))
            ].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 5);
            
            if (allActivities.length === 0) {
                recentActivity.innerHTML = '<p>No recent activity</p>';
            } else {
                recentActivity.innerHTML = allActivities.map(activity => 
                    `<p>${activity.text} - ${new Date(activity.date).toLocaleDateString()}</p>`
                ).join('');
            }
        }

        // Reports
        function updateReports() {
            const totalIncome = income.reduce((sum, item) => sum + item.amount, 0);
            const totalExpenses = expenses.reduce((sum, item) => sum + item.amount, 0);
            const netProfit = totalIncome - totalExpenses;
            
            document.getElementById('reportTotalIncome').textContent = `${totalIncome.toFixed(2)}`;
            document.getElementById('reportTotalExpenses').textContent = `${totalExpenses.toFixed(2)}`;
            document.getElementById('reportNetProfit').textContent = `${netProfit.toFixed(2)}`;
        }

        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const period = document.getElementById('reportPeriod').value;
            
            alert(`Generating ${reportType} report for ${period || 'all time'}...`);
            // Report generation logic would go here
        }

        function exportReport() {
            exportPDF('report');
        }

        // Export Functions - Removed CSV functionality
        // Removed CSV export functionality - PDF only

        function exportPDF(type) {
            // Create PDF content based on type
            let content = '';
            let title = '';
            
            switch(type) {
                case 'loans':
                    title = 'Loans Report';
                    content = generateLoansReport();
                    break;
                case 'income':
                    title = 'Income Report';
                    content = generateIncomeReport();
                    break;
                case 'expenses':
                    title = 'Expenses Report';
                    content = generateExpensesReport();
                    break;
                case 'transactions':
                    title = 'Transactions Report';
                    content = generateTransactionsReport();
                    break;
                case 'clients':
                    title = 'Clients Report';
                    content = generateClientsReport();
                    break;
                case 'report':
                    title = 'Financial Report';
                    content = generateFinancialReport();
                    break;
            }
            
            // Create a printable window
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>${title}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
                        h2 { color: #34495e; margin-top: 30px; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
                        th { background-color: #f8f9fa; font-weight: bold; }
                        .summary { background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 20px 0; }
                        .total { font-weight: bold; color: #2c3e50; }
                        @media print { 
                            body { margin: 0; }
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <h1>${title}</h1>
                    <p><strong>Generated on:</strong> ${new Date().toLocaleDateString('en-ZA')} at ${new Date().toLocaleTimeString('en-ZA')}</p>
                    ${content}
                    <div class="no-print" style="margin-top: 30px;">
                        <button onclick="window.print()" style="background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Print PDF</button>
                        <button onclick="window.close()" style="background: #95a5a6; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-left: 10px;">Close</button>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
        }

        function generateLoansReport() {
            if (loans.length === 0) return '<p>No loans found.</p>';
            
            const totalAmount = loans.reduce((sum, loan) => sum + loan.amount, 0);
            const activeLoans = loans.filter(loan => loan.status === 'active');
            const overdueLoans = loans.filter(loan => loan.status === 'overdue');
            
            let html = `
                <div class="summary">
                    <h2>Summary</h2>
                    <p><strong>Total Loans:</strong> ${loans.length}</p>
                    <p><strong>Active Loans:</strong> ${activeLoans.length}</p>
                    <p><strong>Overdue Loans:</strong> ${overdueLoans.length}</p>
                    <p class="total"><strong>Total Amount:</strong> R${totalAmount.toFixed(2)}</p>
                </div>
                
                <h2>Loan Details</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Client</th>
                            <th>Amount</th>
                            <th>Interest Rate</th>
                            <th>Start Date</th>
                            <th>Due Date</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            loans.forEach(loan => {
                const client = clients.find(c => c.id === loan.clientId);
                const clientName = client ? `${client.firstName} ${client.lastName}` : 'Unknown Client';
                html += `
                    <tr>
                        <td>${clientName}</td>
                        <td>R${loan.amount.toFixed(2)}</td>
                        <td>${loan.interestRate}%</td>
                        <td>${new Date(loan.startDate).toLocaleDateString('en-ZA')}</td>
                        <td>${new Date(loan.dueDate).toLocaleDateString('en-ZA')}</td>
                        <td>${loan.status.toUpperCase()}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            return html;
        }

        function generateIncomeReport() {
            if (income.length === 0) return '<p>No income records found.</p>';
            
            const totalIncome = income.reduce((sum, item) => sum + item.amount, 0);
            const bySource = income.reduce((acc, item) => {
                acc[item.source] = (acc[item.source] || 0) + item.amount;
                return acc;
            }, {});
            
            let html = `
                <div class="summary">
                    <h2>Summary</h2>
                    <p class="total"><strong>Total Income:</strong> R${totalIncome.toFixed(2)}</p>
                    <h3>By Source:</h3>
            `;
            
            Object.entries(bySource).forEach(([source, amount]) => {
                html += `<p><strong>${source}:</strong> R${amount.toFixed(2)}</p>`;
            });
            
            html += `
                </div>
                
                <h2>Income Details</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Source</th>
                            <th>Description</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            income.forEach(item => {
                html += `
                    <tr>
                        <td>${new Date(item.date).toLocaleDateString('en-ZA')}</td>
                        <td>${item.source}</td>
                        <td>${item.description}</td>
                        <td>R${item.amount.toFixed(2)}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            return html;
        }

        function generateExpensesReport() {
            if (expenses.length === 0) return '<p>No expense records found.</p>';
            
            const totalExpenses = expenses.reduce((sum, item) => sum + item.amount, 0);
            const byCategory = expenses.reduce((acc, item) => {
                acc[item.category] = (acc[item.category] || 0) + item.amount;
                return acc;
            }, {});
            
            let html = `
                <div class="summary">
                    <h2>Summary</h2>
                    <p class="total"><strong>Total Expenses:</strong> R${totalExpenses.toFixed(2)}</p>
                    <h3>By Category:</h3>
            `;
            
            Object.entries(byCategory).forEach(([category, amount]) => {
                html += `<p><strong>${category}:</strong> R${amount.toFixed(2)}</p>`;
            });
            
            html += `
                </div>
                
                <h2>Expense Details</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Category</th>
                            <th>Description</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            expenses.forEach(item => {
                html += `
                    <tr>
                        <td>${new Date(item.date).toLocaleDateString('en-ZA')}</td>
                        <td>${item.category}</td>
                        <td>${item.description}</td>
                        <td>R${item.amount.toFixed(2)}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            return html;
        }

        function generateTransactionsReport() {
            const allTransactions = [
                ...income.map(item => ({...item, type: 'income', categorySource: item.source})),
                ...expenses.map(item => ({...item, type: 'expense', categorySource: item.category}))
            ].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (allTransactions.length === 0) return '<p>No transactions found.</p>';
            
            const totalIncome = income.reduce((sum, item) => sum + item.amount, 0);
            const totalExpenses = expenses.reduce((sum, item) => sum + item.amount, 0);
            const netBalance = totalIncome - totalExpenses;
            
            let html = `
                <div class="summary">
                    <h2>Summary</h2>
                    <p><strong>Total Income:</strong> R${totalIncome.toFixed(2)}</p>
                    <p><strong>Total Expenses:</strong> R${totalExpenses.toFixed(2)}</p>
                    <p class="total"><strong>Net Balance:</strong> R${netBalance.toFixed(2)}</p>
                </div>
                
                <h2>All Transactions</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Category/Source</th>
                            <th>Description</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            allTransactions.forEach(transaction => {
                const sign = transaction.type === 'income' ? '+' : '-';
                const color = transaction.type === 'income' ? 'green' : 'red';
                html += `
                    <tr>
                        <td>${new Date(transaction.date).toLocaleDateString('en-ZA')}</td>
                        <td>${transaction.type.toUpperCase()}</td>
                        <td>${transaction.categorySource}</td>
                        <td>${transaction.description}</td>
                        <td style="color: ${color}">${sign}R${transaction.amount.toFixed(2)}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            return html;
        }

        function generateClientsReport() {
            if (clients.length === 0) return '<p>No clients found.</p>';
            
            let html = `
                <div class="summary">
                    <h2>Summary</h2>
                    <p><strong>Total Clients:</strong> ${clients.length}</p>
                </div>
                
                <h2>Client Details</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Phone</th>
                            <th>Email</th>
                            <th>Total Loans</th>
                            <th>Active Loans</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            clients.forEach(client => {
                const clientLoans = loans.filter(loan => loan.clientId === client.id);
                const activeLoans = clientLoans.filter(loan => loan.status === 'active');
                
                html += `
                    <tr>
                        <td>${client.firstName} ${client.lastName}</td>
                        <td>${client.phone}</td>
                        <td>${client.email || 'N/A'}</td>
                        <td>${clientLoans.length}</td>
                        <td>${activeLoans.length}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            return html;
        }

        function generateFinancialReport() {
            const totalIncome = income.reduce((sum, item) => sum + item.amount, 0);
            const totalExpenses = expenses.reduce((sum, item) => sum + item.amount, 0);
            const netProfit = totalIncome - totalExpenses;
            const totalLoans = loans.reduce((sum, loan) => sum + loan.amount, 0);
            const activeLoans = loans.filter(loan => loan.status === 'active');
            const overdueLoans = loans.filter(loan => loan.status === 'overdue');
            
            return `
                <div class="summary">
                    <h2>Financial Overview</h2>
                    <p><strong>Total Income:</strong> R${totalIncome.toFixed(2)}</p>
                    <p><strong>Total Expenses:</strong> R${totalExpenses.toFixed(2)}</p>
                    <p class="total"><strong>Net Profit:</strong> R${netProfit.toFixed(2)}</p>
                </div>
                
                <div class="summary">
                    <h2>Loan Portfolio</h2>
                    <p><strong>Total Loans:</strong> ${loans.length}</p>
                    <p><strong>Active Loans:</strong> ${activeLoans.length}</p>
                    <p><strong>Overdue Loans:</strong> ${overdueLoans.length}</p>
                    <p class="total"><strong>Total Loan Amount:</strong> R${totalLoans.toFixed(2)}</p>
                </div>
                
                <div class="summary">
                    <h2>Business Performance</h2>
                    <p><strong>Profit Margin:</strong> ${totalIncome > 0 ? ((netProfit / totalIncome) * 100).toFixed(2) : 0}%</p>
                    <p><strong>Total Clients:</strong> ${clients.length}</p>
                    <p><strong>Average Loan Size:</strong> R${loans.length > 0 ? (totalLoans / loans.length).toFixed(2) : 0}</p>
                </div>
            `;
        }

        // Chart Setup (Basic implementation)
        function setupCharts() {
            drawMonthlyChart();
            drawProfitChart();
        }

        function drawMonthlyChart() {
            const canvas = document.getElementById('monthlyChart');
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Simple bar chart representation
            ctx.fillStyle = '#3498db';
            ctx.fillRect(50, 50, 30, 100);
            ctx.fillStyle = '#27ae60';
            ctx.fillRect(100, 75, 30, 75);
            ctx.fillStyle = '#e74c3c';
            ctx.fillRect(150, 100, 30, 50);
            
            ctx.fillStyle = '#2c3e50';
            ctx.font = '14px Arial';
            ctx.fillText('Income vs Expenses', 50, 30);
            ctx.fillText('Jan', 55, 170);
            ctx.fillText('Feb', 105, 170);
            ctx.fillText('Mar', 155, 170);
        }

        function drawProfitChart() {
            const canvas = document.getElementById('profitChart');
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const totalIncome = income.reduce((sum, item) => sum + item.amount, 0);
            const totalExpenses = expenses.reduce((sum, item) => sum + item.amount, 0);
            
            // Simple pie chart representation
            ctx.beginPath();
            ctx.arc(200, 100, 80, 0, Math.PI);
            ctx.fillStyle = '#27ae60';
            ctx.fill();
            
            ctx.beginPath();
            ctx.arc(200, 100, 80, Math.PI, 2 * Math.PI);
            ctx.fillStyle = '#e74c3c';
            ctx.fill();
            
            ctx.fillStyle = '#2c3e50';
            ctx.font = '14px Arial';
            ctx.fillText('Profit/Loss Overview', 120, 30);
        }

        // Set default dates
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('loanStartDate').value = today;
            document.getElementById('incomeDate').value = today;
            document.getElementById('expenseDate').value = today;
            
            const currentMonth = new Date().toISOString().slice(0, 7);
            document.getElementById('reportPeriod').value = currentMonth;
        });
    </script>
</body>
</html>